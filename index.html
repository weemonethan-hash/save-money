<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Hours Calculator & Reminders</title>
<style>
body{font-family:system-ui;max-width:760px;margin:24px auto;padding:0 16px;color:#111}
header{display:flex;align-items:center;gap:12px}
img.logo{width:56px;height:56px;object-fit:cover;border-radius:8px;border:1px solid #ddd}
.card{border:1px solid #eee;padding:12px;border-radius:8px;margin-top:12px}
label{display:block;margin-top:8px;font-size:13px}
input,button,select{padding:8px;margin-top:6px;width:100%;box-sizing:border-box}
.row{display:flex;gap:8px}
.row > *{flex:1}
ul{padding-left:18px}
.small{font-size:13px;color:#555}
</style>
</head>
<body>
<header>
<img id="logoImg" class="logo" src="" alt="" style="display:none">
<div>
<h1 style="margin:0;font-size:20px" id="appTitle">Hours Calculator</h1>
<div class="small">Save rate · compute hours · set reminders</div>
</div>
</header>

<div class="card">
<h3 style="margin:0 0 6px 0">Profile (saved locally)</h3>
<label>App / Project name
<input id="projectName" placeholder="e.g. Freelance / My Shop">
</label>
<label>Logo (image file)
<input id="logoFile" type="file" accept="image/*">
</label>
<label>Hourly rate (currency numbers only)
<input id="hourlyRate" type="number" min="0" step="0.01" placeholder="e.g. 25.00">
</label>
<div class="row">
<button id="saveProfile">Save profile</button>
<button id="clearProfile">Clear</button>
</div>
</div>

<div class="card">
<h3 style="margin:0 0 6px 0">Price → Hours</h3>
<label>Price you want to earn
<input id="priceInput" type="number" min="0" step="0.01" placeholder="e.g. 250">
</label>
<div class="row">
<button id="calcBtn">Calculate hours</button>
<button id="addReminderFromCalc">Set reminder for this task</button>
</div>
<div id="calcResult" class="small" style="margin-top:8px"></div>
</div>

<div class="card">
<h3 style="margin:0 0 6px 0">Reminders</h3>
<label>Reminder name
<input id="remName" placeholder="e.g. Follow up client">
</label>
<label>When (date & time)
<input id="remWhen" type="datetime-local">
</label>
<div class="row">
<button id="setRem">Set reminder</button>
<button id="clearFired">Remove fired reminders</button>
</div>
<div style="margin-top:8px">
<strong>Upcoming:</strong>
<ul id="remList"></ul>
</div>
<div class="small" style="margin-top:8px">
Note: notifications require permission and the page must remain open to deliver reminders.
</div>
</div>

<script>
/* Simple app using localStorage. Keys:
'hr_profile' -> {name, rate, logoDataUrl}
'hr_reminders' -> [{id,name,whenISO,fired}]
*/
const el = id => document.getElementById(id);

function loadProfile(){
const p = JSON.parse(localStorage.getItem('hr_profile')||'null');
if(p){
el('projectName').value = p.name || '';
el('hourlyRate').value = p.rate || '';
if(p.logoDataUrl){ el('logoImg').src = p.logoDataUrl; el('logoImg').style.display='block'; }
el('appTitle').textContent = p.name || 'Hours Calculator';
} else {
el('logoImg').style.display='none';
el('appTitle').textContent = 'Hours Calculator';
}
}
function saveProfile(){
const name = el('projectName').value.trim();
const rate = parseFloat(el('hourlyRate').value) || 0;
const logoDataUrl = el('logoImg').src || '';
localStorage.setItem('hr_profile', JSON.stringify({name,rate,logoDataUrl}));
loadProfile();
alert('Saved');
}
function clearProfile(){
if(confirm('Clear saved profile?')) {
localStorage.removeItem('hr_profile');
loadProfile();
}
}

/* logo file -> dataURL */
el('logoFile').addEventListener('change', e=>{
const f = e.target.files[0];
if(!f) return;
const r = new FileReader();
r.onload = ()=> {
el('logoImg').src = r.result;
el('logoImg').style.display='block';
};
r.readAsDataURL(f);
});

/* Calculator */
function calcHours(price, rate){
if(!rate || rate <= 0) return null;
const hours = price / rate;
const whole = Math.floor(hours);
const minutes = Math.round((hours - whole) * 60);
return {hours: hours, text: `${hours.toFixed(2)} hrs (${whole}h ${minutes}m)`};
}
el('calcBtn').addEventListener('click', ()=>{
const price = parseFloat(el('priceInput').value) || 0;
const p = JSON.parse(localStorage.getItem('hr_profile')||'null');
const rate = p ? (parseFloat(p.rate)||0) : (parseFloat(el('hourlyRate').value)||0);
const res = calcHours(price, rate);
el('calcResult').textContent = res ? `Needs ${res.text}` : 'Set a valid hourly rate first.';
});

/* Reminders */
function getReminders(){ return JSON.parse(localStorage.getItem('hr_reminders')||'[]'); }
function saveReminders(list){ localStorage.setItem('hr_reminders', JSON.stringify(list)); renderRemList(); }
function renderRemList(){
const list = getReminders();
const ul = el('remList'); ul.innerHTML = '';
if(list.length===0){ ul.innerHTML = '<li class="small">No reminders</li>'; return; }
list.sort((a,b)=> new Date(a.whenISO) - new Date(b.whenISO));
for(const r of list){
const li = document.createElement('li');
const when = new Date(r.whenISO);
li.innerHTML = `<strong>${r.name}</strong> — ${when.toLocaleString()} ${r.fired?'<em>(done)</em>':''}
<div style="margin-top:6px">
<button data-id="${r.id}" class="del">Delete</button>
</div>`;
ul.appendChild(li);
}
ul.querySelectorAll('.del').forEach(btn=>{
btn.addEventListener('click', ()=> {
const id = btn.getAttribute('data-id');
const filtered = getReminders().filter(x=>x.id!==id);
saveReminders(filtered);
});
});
}
el('setRem').addEventListener('click', ()=>{
const name = el('remName').value.trim() || 'Reminder';
const when = el('remWhen').value;
if(!when){ alert('Pick date & time'); return; }
const id = 'r'+Date.now()+'_'+Math.random().toString(36).slice(2,8);
const list = getReminders();
list.push({id,name,whenISO:new Date(when).toISOString(),fired:false});
saveReminders(list);
el('remName').value=''; el('remWhen').value='';
alert('Reminder saved');
});

/* Set reminder from calculated price (prefill name) */
el('addReminderFromCalc').addEventListener('click', ()=>{
const price = parseFloat(el('priceInput').value)||0;
const p = JSON.parse(localStorage.getItem('hr_profile')||'null');
const rate = p ? (parseFloat(p.rate)||0) : (parseFloat(el('hourlyRate').value)||0);
const res = calcHours(price, rate);
if(!res){ alert('Set hourly rate first'); return; }
el('remName').value = `Earn ${price} (${res.hours.toFixed(1)}h)`;
el('remWhen').focus();
});

/* remove fired reminders */
el('clearFired').addEventListener('click', ()=>{
const filtered = getReminders().filter(r=>!r.fired);
saveReminders(filtered);
});

/* clear profile buttons */
el('saveProfile').addEventListener('click', saveProfile);
el('clearProfile').addEventListener('click', clearProfile);

/* Notifications permission */
function ensureNotificationPermission(){
if(!('Notification' in window)) return Promise.resolve(false);
if(Notification.permission === 'granted') return Promise.resolve(true);
if(Notification.permission !== 'denied') return Notification.requestPermission().then(p => p === 'granted');
return Promise.resolve(false);
}

/* check loop: every 5 seconds, check reminders and fire if due */
function checkReminders(){
const now = new Date();
const list = getReminders();
let changed = false;
for(const r of list){
if(r.fired) continue;
const when = new Date(r.whenISO);
if(now >= when){
r.fired = true;
changed = true;
ensureNotificationPermission().then(ok=>{
const msg = `${r.name} — ${when.toLocaleString()}`;
if(ok){
try { new Notification(r.name, {body: 'Reminder due: '+when.toLocaleString(), icon: (el('logoImg').src||undefined)}); }
catch(e){ alert(msg); }
} else {
alert('Reminder: '+msg);
}
});
}
}
if(changed) saveReminders(list);
}
/* run check loop */
setInterval(checkReminders, 5000);
window.addEventListener('load', ()=>{
loadProfile();
renderRemList();
checkReminders();
});

/* initial load: if no profile, try load from fields */
(function init(){
loadProfile();
renderRemList();
})();
</script>
</body>
</html>
